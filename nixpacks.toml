[phases.setup]
nixPkgs = ["php83", "php83Packages.composer", "nodejs_20"]

[phases.build]
cmds = ["composer install --no-dev --optimize-autoloader", "npm install", "npm run build"]

#[start]
#cmd = "rm -f bootstrap/cache/*.php && php artisan package:discover && php artisan config:clear && (php artisan storage:link || true) && php artisan serve --host=0.0.0.0 --port=$PORT"

[start]
cmd = """
    mkdir -p storage/framework/{cache/data,sessions,views} storage/logs storage/app/{public,livewire-tmp} && \
    chmod -R 775 storage bootstrap/cache && \
    rm -f bootstrap/cache/*.php && \
    php artisan package:discover && \
    php artisan config:clear && \
    (php artisan storage:link || true) && \
    php artisan serve --host=0.0.0.0 --port=$PORT
"""